<?xml version="1.0"?>
<launch>
    <!-- ZED wrapper -->
    <arg name="publish_tf"       default="true"/>
    <arg name="camera"           default="zed"/>
    <!-- Laserscan topic -->
    <arg name="scan_topic"       default="scan"/>
    <arg name="scan_processing"  default="false"/>
    <arg name="cloud_frame_id"   default="zed_initial_frame"/>
    <!-- Republish RGB and depth -->
    <arg name="republish_topic"  default="true"/>
  
    <!-- Launch ZED camera node -->
    <group ns="$(arg camera)">
  
        <include file="$(find zed_wrapper)/launch/zed_camera.launch">
            <!-- Definition coordinate frames -->
            <arg name="publish_tf"            default="$(arg publish_tf)" />
            <arg name="odometry_frame"        default="odom" />
            <arg name="base_frame"            default="base_link" />
            <arg name="camera_frame"          default="zed_left_camera" />
            <arg name="depth_frame"           default="zed_depth_camera" />
            <!-- Publish urdf zed -->
            <arg name="publish_urdf"          default="false" />
        </include>
    
        <!-- TEMP Will be remove after fix from zed error -->
        <group if="$(arg republish_topic)">        
            <node name="republish_rgb"   type="republish" pkg="image_transport" args="raw in:=rgb/image_rect_color_raw out:=rgb/image_rect_color" />
            <node name="republish_depth" type="republish" pkg="image_transport" args="raw in:=depth/depth_registered_raw out:=depth/depth_registered" />
        </group> 
        <!--                        Laserscan 
            This uses lazy subscribing, so will not activate until scan is requested.
          -->
        <group if="$(arg scan_processing)">
            <node name="depthimage_to_laserscan" pkg="depthimage_to_laserscan" type="depthimage_to_laserscan" output="screen">
                <param name="scan_height" value="7"/>
                <param name="output_frame_id" value="$(arg cloud_frame_id)"/>
                <param name="range_min" value="0.1"/>
                <remap from="image" to="depth/depth_registered"/>
                <remap from="camera_info" to="depth/camera_info"/>
                <remap from="scan" to="$(arg scan_topic)"/>
            </node>
        </group>
    
    </group>

</launch>
